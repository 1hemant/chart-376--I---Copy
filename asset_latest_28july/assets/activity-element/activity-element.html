<link href="../bower_components/polymer/polymer.html" rel="import" />
<dom-module id="activity-element">
    <template>
		<style>	
			:host.nav-expanded .block__activity--panel {
			  right: 0;
			}
			:host.nav-expanded{
			  margin-left: 0em;
			  transition: right 0.4s ease-in-out 0s;
			  -webkit-transition: right 0.4s ease-in-out 0s;
			  -moz-transition: right 0.4s ease-in-out 0s;
			  -o-transition: right 0.4s ease-in-out 0s;
			}
			a.nav-expander {
			  background: none repeat scroll 0 0 #000000;
			  color: #FFFFFF;
			  display: block;
			  font-size: 15px;
			  font-weight: 400;
			  height: 50px;
			  margin-right: 0;
			  padding: 1em 1.6em 2em;
			  position: relative;
			  right: 0;
			  text-decoration: none;
			  text-transform: uppercase;
			  top: 0;
			  transition: right 0.3s ease-in-out 0s;
			  /*width: 420px;*/
			  z-index: 12;

			  transition: right 0.3s ease-in-out 0s;
			  -webkit-transition: right 0.3s ease-in-out 0s;
			  -moz-transition: right 0.3s ease-in-out 0s;
			  -o-transition: right 0.3s ease-in-out 0s;

			}

			a.nav-expander:hover {
			  cursor: pointer;
			}

			a.nav-expander.fixed {
			  /*position: fixed;*/
			}

			.nav-expanded a.nav-expander.fixed {
				/*right: 20em;*/
			}

			.block__activity--panel {
			  background: #fff;
			  display: block;
			  height: 100%;
			  overflow: hidden;
			  position: fixed;
			  right: -420px;
			  font-size: 15px;
			  top: 60px;
			  width: 420px;
			  z-index: 2000;
			  
			  transition: right 0.3s ease-in-out 0s;
			  -webkit-transition: right 0.3s ease-in-out 0s;
			  -moz-transition: right 0.3s ease-in-out 0s;
			  -o-transition: right 0.3s ease-in-out 0s;
			  box-shadow: 0 0 8px 0 rgba(0,0,0,.2)

			}
			.nav-expanded .block__activity--panel {
			  right: 0;
			}

			body.nav-expanded {
			  margin-left: 0em;
			  transition: right 0.4s ease-in-out 0s;
			  -webkit-transition: right 0.4s ease-in-out 0s;
			  -moz-transition: right 0.4s ease-in-out 0s;
			  -o-transition: right 0.4s ease-in-out 0s;
			}

			#nav-close {
			  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
			  font-weight: 300;
			  font-size: 24px;
			  padding-right: 10px;
			}

			.main-menu {
			  padding-top: 12px;
			}

			.main-menu li {
			  border-bottom: 1px solid #323949;
			  margin-left: 20px;
			  font-size: 18px;
			  padding: 12px;
			}

			.main-menu li a {
			  color: #6F7D8C;
			  text-decoration: none;
			}

			.main-menu li a:hover {
			  color: #FFFFFF;
			  text-decoration: none;
			}

			.main-menu li .sub-nav {
			  border-bottom: 0px;
			  padding: 4px;
			}

			.main-menu a .caret {
				width: 0;
				height: 0;
				display: inline-block;
				vertical-align: top;
				border-top: 4px solid #4f5963;
				border-right: 4px solid transparent;
				border-left: 4px solid transparent;
				content: "";
				margin-top: 8px;
			}

			.main-menu a:hover .caret {
				border-top-color: #4f5963;
			}

			.main-menu li.open > a > .caret {
				border-top: none;
				border-bottom: 4px solid #4f5963;
				border-right: 4px solid transparent;
				border-left: 4px solid transparent;
			}

			.main-menu li.open > a:hover > .caret {
				border-bottom-color: #4f5963;
			}

			.icon:before {
			  font-family: 'FontAwesome';
			  font-style: normal;
			  font-variant: normal;
			  font-weight: normal;
			  line-height: 1;
			  text-transform: none;
			  content: '\f105';
			}

			.main-menu li > a > span.icon {
			  float: right;
			  margin: 0.1em 1.7em -0.1em 0;
			  opacity: 0;
			  -webkit-transition: all 0.2s ease-in-out;
			  -moz-transition: all 0.2s ease-in-out;
			  -o-transition: all 0.2s ease-in-out;
			  transition: all 0.2s ease-in-out;

			}

			.main-menu li > a:hover > span.icon {
			  float: right;
			  margin: 0.1em 0.8em -0.1em 0;
			  opacity: 1;
			}
			#widget--activityPanel{
			  position: relative;
			  padding: 0;
			  border:1px solid #eaeaea;
			  border-left: none;
			  border-right: none;
			  float: left;
			  width: 100%;
                 font-family: 'Open Sans', sans-serif;
			}

			#widget--activityPanel .activity-header,
			#widget--activityPanel .activity-footer{
			  position: relative;
			  padding: 10px;
			  margin: 0;
			  border-bottom: 1px solid #eaeaea
			}

			#widget--activityPanel .activity-footer{
			  border-top: 1px solid #eaeaea;
			  border-bottom: none;
			  float: left;
			  width: 100%;
			}

			.activity-footer{
			  text-align: center;
			  text-transform: uppercase;
			  font-size: 12px;
			  font-weight: 600;
			}
			.activity-footer a{
			  color: #fff;
			  text-decoration: none;
                           padding:6px;
                           border-radius:10px;
                           background:#00aaf9;
                           
			}
			.activity-header h2{
			  font-size: 20px;
			  font-weight: 600;
			  margin: 6px 0;
			  padding: 0;
			}

			ul#widget-activity-list {
			  margin: 0;
			  padding: 0;
			  width: 100%;
			  overflow-y: auto;
				overflow-x: hidden;
				height: calc(100vh - 152px);
			  float: left;
			}

			ul#widget-activity-list li{
			  list-style: none;
			  display: block;
			  float: left;
			  width: 100%;
			  border-bottom: 1px solid #eaeaea;
			  margin: 0;
			  padding: 10px;
			  padding-left: 70px;
			  position: relative;
                    min-height:70px
			}

			ul#widget-activity-list li:last-child{
			  border-bottom: none;
			}

			ul#widget-activity-list li:hover{
			  background: #f1f1f1;
			  transition: all .2s ease-out
			}
			.user-pic-ap{
			  width: 50px;
			  height: 50px;
			  border-radius: 4px;
			  background: #ebebeb;
			  border:1px solid #d7d7d7;
			  position: absolute;
			  left: 10px;
			  top: 10px;
			}

			.user-pic-ap > span{
			  font-size: 24px;
			  line-height: 50px;
			  text-align: center;
			  text-transform: uppercase;
			  display: block;
			  letter-spacing: 2px;
			  opacity: .6;
			}

			ul#widget-activity-list li p{
			  margin-bottom: 6px;
       font-size:13px;
        
                         
			}
			.timeStamp{
			  display: block;
			  font-size: 13px;
			  color: #a6a6a6;
			}

			.btn-view-ap{
			  display: block;
			  font-size: 13px;
			  margin-top: 6px;
			}

			.highlight-text-bold{
			  font-weight: 600;
			}
			
			a.close_panel{
				position:absolute;
				right:10px;
				width:30px;
				height:30px;
				top:16px;
				display:block;
				cursor:pointer
			}
			
			.close_panel i{
				vertical-align:middle;
			}
		</style>
		<div class="block__activity--panel">
		  <div id="widget--activityPanel">
			<div class="activity-header">
			  <h2>
				Activity Panel 
				
				<a class="close_panel" on-tap="closeNotification"><i class="material-icons">close</i></a>
			  </h2>
			</div>
			<ul id="widget-activity-list">
				<template is="dom-repeat" items="{{notifications}}">
						<li data-id="{{item.notificationId}}">
							<div class="user-pic-ap"><span>{{item.nameInitials}}</span></div>
							<p><span class="highlight-text-bold">{{item.notification}}</span></p>
							<!--</span> shared <span class="highlight-text-bold">Exhibit C</span> with you as <span class="highlight-text-bold">Risk</span> -->
							<span class="timeStamp" data-timestamp$="{{item.timestamp}}"></span>
							<a href="#" class="btn-view-ap">View Details</a>
						</li>
				</template>
			</ul>
			<div class="activity-footer">
			  <!--<a href="">View All</a>-->
			</div>
		  </div>
		  <!-- widget activityPanel -->
	   </div>
    </template>
    <script>
        Polymer({
            is: "activity-element",
			properties:{
				notifications:{
					type:Array,
					value:function(){
						return [];
					},
					notify:true
				},
				notificationsService:{
					type:String,
					value:"single/get-notification",
					readonly:true
				}
			},
			ready:function(){
				var b=document.createElement('base-util'),self=this;
				setInterval(function(){
					b.sendRequest(self.notificationsService,{"data":{"isReaded":0}},function(e){
					var data=[],readed=0;
						$.each(e.data,function(i,k){
							//var nameInitials = k.sentBy.replace(/[^A-Z]/g, '');
							var nameInitials = k.sentBy?k.sentBy[0]:"A"; //First letter from email, we should use 2 First Letters from Full Name
							data.push({notificationId:k.notificationId, nameInitials:nameInitials, isRead:k.isReaded,timestamp:k.sentOn,notification:k.configuration.description});
							readed+=Number(k.isReaded);
						})
						
						data.sort(function(a,b){ 
							var dateA = new Date(a.timestamp), dateB=new Date(b.timestamp); 
							return dateB - dateA
						});
						
						self.notifications=data;
						document.querySelector('header-element').notification=(Object.keys(e.data).length  - readed);
					},{})
				},4000);
			},
			closeNotification:function(e){
				e.preventDefault();
				$(document.querySelector('activity-element')).removeClass('nav-expanded');
			},
			attached:function(){
				this.async(function(){
					Polymer.dom.flush();
					$('[data-timestamp]').each(function(){
						$(this).html(moment(new Date($(this).data('timestamp'))).fromNow());
					})
				})
			}
        });
    </script>
</dom-module>
